<Page x:Class="BlackFlag.Views.EcuUnlockPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="ECU Processor Unlock"
      Background="{DynamicResource BackgroundBrush}">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <TextBlock Grid.Row="0" Text="ðŸ”“ ECU PROCESSOR UNLOCK &amp; SECURITY BYPASS" FontSize="24" FontWeight="Bold" 
                   Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,20"/>
        
        <!-- Warning Banner -->
        <Border Grid.Row="1" Background="#CC3333" Padding="15" Margin="0,0,0,20" CornerRadius="5">
            <StackPanel>
                <TextBlock Text="âš ï¸ PROFESSIONAL USE ONLY - READ CAREFULLY" FontWeight="Bold" FontSize="16" 
                           Foreground="White" Margin="0,0,0,10"/>
                <TextBlock TextWrapping="Wrap" Foreground="White" LineHeight="20">
                    <Run Text="â€¢ This feature bypasses ECU security to enable tuning/diagnostics"/>
                    <LineBreak/>
                    <Run Text="â€¢ ALWAYS backup original firmware before proceeding"/>
                    <LineBreak/>
                    <Run Text="â€¢ Incorrect procedures can brick your ECU ($1000+ replacement)"/>
                    <LineBreak/>
                    <Run Text="â€¢ Requires stable 12-14V power supply during entire process"/>
                    <LineBreak/>
                    <Run Text="â€¢ User assumes all risk - for professional tuners only"/>
                </TextBlock>
            </StackPanel>
        </Border>
        
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <Grid Margin="0,0,15,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="1*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Main Control Panel -->
                <StackPanel Grid.Column="0">
                    <!-- ECU Selection -->
                    <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,15">
                        <StackPanel>
                            <TextBlock Text="1ï¸âƒ£ ECU SELECTION" FontSize="18" FontWeight="Bold" 
                                       Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,15"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="ECU Vendor:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" x:Name="VendorSelector" 
                                          Style="{DynamicResource ComboBoxStyle}" Margin="0,0,0,10"
                                          SelectionChanged="VendorSelector_SelectionChanged">
                                    <ComboBoxItem Content="Bosch (ME7, MED17, EDC17)" IsSelected="True"/>
                                    <ComboBoxItem Content="Siemens/Continental (SIMOS, EMS, MSD)"/>
                                    <ComboBoxItem Content="Denso (Common Rail, Gasoline)"/>
                                    <ComboBoxItem Content="Delphi/Delco (MT80, E78, E38)"/>
                                    <ComboBoxItem Content="Magneti Marelli (IAW, MJD)"/>
                                    <ComboBoxItem Content="Hitachi"/>
                                    <ComboBoxItem Content="Visteon"/>
                                </ComboBox>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="ECU Model:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <ComboBox Grid.Row="1" Grid.Column="1" x:Name="ModelSelector" 
                                          Style="{DynamicResource ComboBoxStyle}" Margin="0,0,0,10"
                                          SelectionChanged="ModelSelector_SelectionChanged"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Processor:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="ProcessorInfo" 
                                          Foreground="{DynamicResource AccentBrush}" FontWeight="Bold"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                    
                    <!-- Connection Setup -->
                    <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,15">
                        <StackPanel>
                            <TextBlock Text="2ï¸âƒ£ CONNECTION SETUP" FontSize="18" FontWeight="Bold" 
                                       Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,15"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="J2534 Device:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" x:Name="DeviceSelector" 
                                          Style="{DynamicResource ComboBoxStyle}" Margin="0,0,10,10"/>
                                <Button Grid.Row="0" Grid.Column="2" Content="ðŸ”„ Refresh" 
                                        Style="{DynamicResource ButtonStyle}" Click="RefreshDevices_Click" Margin="0,0,0,10"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Protocol:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                <ComboBox Grid.Row="1" Grid.Column="1" x:Name="ProtocolSelector" 
                                          Style="{DynamicResource ComboBoxStyle}" Margin="0,0,0,10" Grid.ColumnSpan="2">
                                    <ComboBoxItem Content="CAN (ISO 15765)" IsSelected="True"/>
                                    <ComboBoxItem Content="K-Line (ISO 9141)"/>
                                    <ComboBoxItem Content="K-Line (ISO 14230 KWP2000)"/>
                                    <ComboBoxItem Content="J1850 PWM"/>
                                    <ComboBoxItem Content="J1850 VPW"/>
                                </ComboBox>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Baud Rate:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox Grid.Row="2" Grid.Column="1" x:Name="BaudRateSelector" 
                                          Style="{DynamicResource ComboBoxStyle}" Grid.ColumnSpan="2">
                                    <ComboBoxItem Content="500000 (CAN HS)" IsSelected="True"/>
                                    <ComboBoxItem Content="250000 (CAN MS)"/>
                                    <ComboBoxItem Content="125000 (CAN LS)"/>
                                    <ComboBoxItem Content="10400 (K-Line)"/>
                                    <ComboBoxItem Content="9600"/>
                                </ComboBox>
                            </Grid>
                            
                            <Button x:Name="ConnectBtn" Content="ðŸ”Œ CONNECT TO ECU" 
                                    Style="{DynamicResource ButtonStyle}" 
                                    Click="Connect_Click" Margin="0,15,0,0" Height="45" FontSize="16" FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Unlock Process -->
                    <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,15" x:Name="UnlockPanel" Visibility="Collapsed">
                        <StackPanel>
                            <TextBlock Text="3ï¸âƒ£ UNLOCK PROCESS" FontSize="18" FontWeight="Bold" 
                                       Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,15"/>
                            
                            <TextBlock Text="Security Access Method:" Margin="0,0,0,5"/>
                            <ComboBox x:Name="UnlockMethodSelector" Style="{DynamicResource ComboBoxStyle}" Margin="0,0,0,15">
                                <ComboBoxItem Content="Seed/Key Algorithm (Most Common)" IsSelected="True"/>
                                <ComboBoxItem Content="Fixed Seed Bypass"/>
                                <ComboBoxItem Content="Boot Mode (BDM/JTAG)"/>
                                <ComboBoxItem Content="Bench Flash (Direct EEPROM)"/>
                                <ComboBoxItem Content="Tricore BSL (Bootstrap Loader)"/>
                            </ComboBox>
                            
                            <CheckBox x:Name="BackupBeforeUnlock" Content="Create backup before unlocking (HIGHLY RECOMMENDED)" 
                                      IsChecked="True" Margin="0,0,0,10" Foreground="{DynamicResource ForegroundBrush}"/>
                            <CheckBox x:Name="VerifyAfterUnlock" Content="Verify checksum after unlock" 
                                      IsChecked="True" Margin="0,0,0,15" Foreground="{DynamicResource ForegroundBrush}"/>
                            
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <Button Grid.Column="0" Content="ðŸ“¥ READ ECU FIRST" 
                                        Style="{DynamicResource ButtonStyle}" Click="ReadEcu_Click" Height="40"/>
                                <Button Grid.Column="2" Content="ðŸ”“ UNLOCK PROCESSOR" 
                                        Style="{DynamicResource ButtonStyle}" Click="UnlockProcessor_Click" 
                                        Height="40" FontWeight="Bold" Background="#FF6600"/>
                            </Grid>
                            
                            <!-- Progress -->
                            <Border Background="{DynamicResource SurfaceBrush}" Padding="10" CornerRadius="3">
                                <StackPanel>
                                    <TextBlock x:Name="ProgressText" Text="Status: Waiting..." Margin="0,0,0,5"/>
                                    <ProgressBar x:Name="ProgressBar" Height="20" Minimum="0" Maximum="100" Value="0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>
                    
                    <!-- Advanced Options -->
                    <Border Style="{DynamicResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="âš™ï¸ ADVANCED OPTIONS" FontSize="18" FontWeight="Bold" 
                                       Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,15"/>
                            
                            <CheckBox Content="Enable verbose logging" Margin="0,0,0,8" Foreground="{DynamicResource ForegroundBrush}"/>
                            <CheckBox Content="Skip immobilizer check" Margin="0,0,0,8" Foreground="{DynamicResource ForegroundBrush}"/>
                            <CheckBox Content="Force boot mode entry" Margin="0,0,0,8" Foreground="{DynamicResource ForegroundBrush}"/>
                            <CheckBox Content="Disable write protection" IsChecked="True" Margin="0,0,0,8" Foreground="{DynamicResource ForegroundBrush}"/>
                            <CheckBox Content="Auto-calculate checksums" IsChecked="True" Foreground="{DynamicResource ForegroundBrush}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
                
                <!-- Info Panel -->
                <StackPanel Grid.Column="2">
                    <!-- ECU Info -->
                    <Border Style="{DynamicResource CardStyle}" Margin="0,0,0,15">
                        <StackPanel>
                            <TextBlock Text="ðŸ“Š ECU INFORMATION" FontWeight="Bold" 
                                       Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,10"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Status:" Margin="0,0,5,5"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" x:Name="StatusText" Text="Disconnected" 
                                           Foreground="#FF6666" Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Flash Size:" Margin="0,0,5,5"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" x:Name="FlashSizeText" Text="â€”" Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Security:" Margin="0,0,5,5"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="SecurityText" Text="â€”" Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="SW Version:" Margin="0,0,5,5"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" x:Name="SwVersionText" Text="â€”" Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="4" Grid.Column="0" Text="HW Version:" Margin="0,0,5,5"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" x:Name="HwVersionText" Text="â€”" Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Boot Mode:" Margin="0,0,5,0"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" x:Name="BootModeText" Text="â€”"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                    
                    <!-- Activity Log -->
                    <Border Style="{DynamicResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="ðŸ“ ACTIVITY LOG" FontWeight="Bold" 
                                       Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,10"/>
                            <ScrollViewer Height="300" VerticalScrollBarVisibility="Auto">
                                <TextBlock x:Name="ActivityLog" TextWrapping="Wrap" FontFamily="Consolas" FontSize="11"
                                           Foreground="{DynamicResource ForegroundBrush}"/>
                            </ScrollViewer>
                            <Button Content="ðŸ—‘ï¸ Clear Log" Style="{DynamicResource ButtonStyle}" 
                                    Click="ClearLog_Click" Margin="0,10,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
